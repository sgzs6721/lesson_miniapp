<!--index.wxml-->
<view class="page">
  <!-- æ ¡åŒºé€‰æ‹©å™¨ -->
  <view class="campus-selector">
    <view class="campus-name" bindtap="showCampusSelector">
      <text>{{currentCampus.name}}</text>
      <view class="arrow"></view>
    </view>
    <view class="date-display">{{currentDate}}</view>
  </view>

  <!-- æ ¡åŒºé€‰æ‹©å¼¹çª— -->
  <view class="campus-popup {{showCampusSelector ? 'show' : ''}}">
    <view class="campus-popup-mask" bindtap="hideCampusSelector"></view>
    <view class="campus-popup-content">
      <view class="campus-popup-header">
        <text>é€‰æ‹©æ ¡åŒº</text>
        <view class="campus-popup-close" bindtap="hideCampusSelector">Ã—</view>
      </view>
      <scroll-view scroll-y class="campus-list">
        <view wx:if="{{campusList.length === 0}}" class="empty-campus">
          <text>æš‚æ— æ ¡åŒºæ•°æ®</text>
        </view>
        <view
          wx:for="{{campusList}}"
          wx:key="id"
          class="campus-item {{item.id === currentCampus.id ? 'active' : ''}}"
          data-id="{{item.id}}"
          bindtap="selectCampus"
        >
          <text>{{item.name}}</text>
          <view wx:if="{{item.id === currentCampus.id}}" class="campus-selected-icon">âœ“</view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- é¦–é¡µå†…å®¹ -->
  <scroll-view class="scrollarea" scroll-y type="list" enhanced show-scrollbar="{{false}}">
    <!-- æ•°æ®æ¦‚è§ˆ -->
    <view class="data-overview">
      <view class="overview-header">
        <text class="overview-title">ä»Šæ—¥æ•°æ®</text>
      </view>
      <view class="overview-grid">
        <view class="overview-item">
          <view class="overview-value">{{stats.teacherCount}}</view>
          <view class="overview-label">ä¸Šè¯¾è€å¸ˆ</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">{{stats.classCount}}</view>
          <view class="overview-label">ä¸Šè¯¾ç­çº§</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">{{stats.studentCount}}</view>
          <view class="overview-label">ä¸Šè¯¾å­¦å‘˜</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">{{stats.checkinCount}}</view>
          <view class="overview-label">æ‰“å¡æ¬¡æ•°</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">{{stats.consumedHours}}</view>
          <view class="overview-label">æ¶ˆè€—è¯¾æ—¶</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">{{stats.leaveCount}}</view>
          <view class="overview-label">è¯·å‡äººæ•°</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">Â¥{{stats.teacherSalary}}</view>
          <view class="overview-label">è€å¸ˆè¯¾é…¬</view>
        </view>
        <view class="overview-item">
          <view class="overview-value">Â¥{{stats.consumedFees}}</view>
          <view class="overview-label">æ¶ˆè€—è´¹ç”¨</view>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥è¯¾è¡¨ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ä»Šæ—¥è¯¾è¡¨</text>
        <text class="section-more" bindtap="navigateToSchedule">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      <view class="schedule-list">
        <view wx:if="{{scheduleList.length === 0}}" class="empty-tip">
          <view class="empty-icon">ğŸ“…</view>
          <view>ä»Šæ—¥æš‚æ— è¯¾ç¨‹</view>
        </view>
        <view wx:for="{{scheduleList}}" wx:key="id" class="schedule-item">
          <view class="schedule-time">{{item.startTime}}-{{item.endTime}}</view>
          <view class="schedule-info">
            <view class="schedule-course">{{item.courseName}}</view>
            <view class="schedule-detail">
              <text>{{item.teacherName}}</text>
              <text class="dot">Â·</text>
              <text>{{item.roomName}}</text>
              <text class="dot">Â·</text>
              <text>{{item.studentCount}}äºº</text>
            </view>
          </view>
          <view class="schedule-status {{item.status}}">{{item.statusText || 'è¿›è¡Œä¸­'}}</view>
        </view>
      </view>
    </view>

    <!-- ä»Šæ—¥ä¸Šè¯¾å­¦å‘˜ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">ä»Šæ—¥ä¸Šè¯¾å­¦å‘˜</text>
        <text class="section-more" bindtap="navigateToStudents">æŸ¥çœ‹å…¨éƒ¨</text>
      </view>
      <view class="student-list">
        <view wx:if="{{todayStudents.length === 0}}" class="empty-tip">
          <view class="empty-icon">ğŸ‘¨â€ğŸ“</view>
          <view>ä»Šæ—¥æš‚æ— ä¸Šè¯¾å­¦å‘˜</view>
        </view>
        <view wx:for="{{todayStudents}}" wx:key="id" class="student-item">
          <image class="student-avatar" src="{{item.avatarUrl || defaultAvatarUrl}}" mode="aspectFill"></image>
          <view class="student-info">
            <view class="student-name">{{item.name}}</view>
            <view class="student-detail">
              <text>{{item.className}}</text>
              <text class="dot">Â·</text>
              <text>{{item.checkinTime || 'æœªæ‰“å¡'}}</text>
            </view>
          </view>
          <view class="student-status {{item.status}}">{{item.statusText}}</view>
        </view>
      </view>
    </view>

    <!-- å¿«æ·åŠŸèƒ½ -->
    <view class="quick-actions-wrapper">
      <view class="section-header" style="padding: 0 20rpx 20rpx;">
        <text class="section-title">å¿«æ·åŠŸèƒ½</text>
      </view>
      <view class="quick-actions">
        <view class="quick-action-item" wx:for="{{quickActions}}" wx:key="id" bindtap="handleQuickAction" data-id="{{item.id}}">
          <view class="quick-action-icon {{item.icon}}"></view>
          <view class="quick-action-name">{{item.name}}</view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
