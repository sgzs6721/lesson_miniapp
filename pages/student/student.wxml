<!--student.wxml-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'info' ? 'active' : ''}}" bindtap="switchTab" data-tab="info">å­¦å‘˜ä¿¡æ¯</view>
    <view class="tab {{activeTab === 'attendance' ? 'active' : ''}}" bindtap="switchTab" data-tab="attendance">å‡ºå‹¤è®°å½•</view>
  </view>

  <!-- å­¦å‘˜ä¿¡æ¯æ ‡ç­¾é¡µ -->
  <view class="tab-content" hidden="{{activeTab !== 'info'}}">
    <!-- æœç´¢å’Œæ·»åŠ å­¦å‘˜ -->
    <view class="search-add-container">
      <view class="search-box">
        <input type="text" placeholder="æœç´¢å­¦å‘˜" bindinput="onSearch" value="{{searchKey}}" />
        <view class="search-icon">ğŸ”</view>
      </view>
      <button class="add-btn" bindtap="showAddStudent">æ·»åŠ </button>
    </view>

    <!-- å­¦å‘˜åˆ—è¡¨ -->
    <scroll-view class="student-list" scroll-y>
      <view wx:if="{{studentList.length === 0}}" class="empty-tip">æš‚æ— å­¦å‘˜</view>
      <view wx:for="{{studentList}}" wx:key="id" class="student-item">
        <view class="student-info" bindtap="showStudentDetail" data-id="{{item.id}}">
          <image class="student-avatar" src="{{item.avatar || '/images/default-avatar.png'}}"></image>
          <view class="student-detail">
            <view class="student-name">{{item.name}} <text class="student-gender">{{item.gender === 'male' ? 'ç”·' : 'å¥³'}}</text></view>
            <view class="student-meta">
              <text>{{item.age}}å²</text>
              <text class="dot">Â·</text>
              <text>{{item.phone}}</text>
            </view>
            <view class="student-courses">
              <text>{{item.courseCount}}é—¨è¯¾ç¨‹</text>
              <text class="dot">Â·</text>
              <text>{{item.attendanceRate}}å‡ºå‹¤ç‡</text>
            </view>
          </view>
        </view>
        <view class="student-actions">
          <view class="action-btn edit" bindtap="editStudent" data-id="{{item.id}}">ç¼–è¾‘</view>
          <view class="action-btn delete" bindtap="deleteStudent" data-id="{{item.id}}">åˆ é™¤</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å‡ºå‹¤è®°å½•æ ‡ç­¾é¡µ -->
  <view class="tab-content" hidden="{{activeTab !== 'attendance'}}">
    <!-- ç­›é€‰æ¡ä»¶ -->
    <view class="filter-bar">
      <picker mode="date" fields="month" value="{{currentMonth}}" bindchange="onMonthChange">
        <view class="filter-item">
          <text>{{currentMonth || 'é€‰æ‹©æœˆä»½'}}</text>
          <text class="arrow-down">â–¼</text>
        </view>
      </picker>
      <picker mode="selector" range="{{courseList}}" range-key="name" value="{{courseIndex}}" bindchange="onCourseChange">
        <view class="filter-item">
          <text>{{selectedCourse ? selectedCourse.name : 'é€‰æ‹©è¯¾ç¨‹'}}</text>
          <text class="arrow-down">â–¼</text>
        </view>
      </picker>
      <picker mode="selector" range="{{['å…¨éƒ¨', 'å·²åˆ°', 'æœªåˆ°', 'è¯·å‡']}}" value="{{statusIndex}}" bindchange="onStatusChange">
        <view class="filter-item">
          <text>{{statusOptions[statusIndex]}}</text>
          <text class="arrow-down">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- å‡ºå‹¤è®°å½•åˆ—è¡¨ -->
    <scroll-view class="attendance-list" scroll-y>
      <view wx:if="{{attendanceList.length === 0}}" class="empty-tip">æš‚æ— å‡ºå‹¤è®°å½•</view>
      <view wx:for="{{attendanceList}}" wx:key="id" class="attendance-item">
        <view class="attendance-date">{{item.date}}</view>
        <view class="attendance-info">
          <view class="attendance-course">{{item.courseName}}</view>
          <view class="attendance-student">{{item.studentName}}</view>
          <view class="attendance-time">{{item.time}}</view>
        </view>
        <view class="attendance-status {{item.status}}">
          <text>{{item.status === 'checked' ? 'å·²åˆ°' : (item.status === 'absent' ? 'æœªåˆ°' : 'è¯·å‡')}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ·»åŠ /ç¼–è¾‘å­¦å‘˜å¼¹çª— -->
  <view class="modal {{showStudentModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideStudentModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>{{editingStudent ? 'ç¼–è¾‘å­¦å‘˜' : 'æ·»åŠ å­¦å‘˜'}}</text>
        <view class="modal-close" bindtap="hideStudentModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">å§“å</text>
          <input type="text" placeholder="è¯·è¾“å…¥å­¦å‘˜å§“å" value="{{studentForm.name}}" bindinput="onStudentFormInput" data-field="name" />
        </view>
        <view class="form-item">
          <text class="label">æ€§åˆ«</text>
          <picker mode="selector" range="{{['ç”·', 'å¥³']}}" value="{{studentForm.genderIndex}}" bindchange="onGenderChange">
            <view class="picker">
              {{studentForm.gender === 'male' ? 'ç”·' : (studentForm.gender === 'female' ? 'å¥³' : 'è¯·é€‰æ‹©æ€§åˆ«')}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">å¹´é¾„</text>
          <input type="number" placeholder="è¯·è¾“å…¥å¹´é¾„" value="{{studentForm.age}}" bindinput="onStudentFormInput" data-field="age" />
        </view>
        <view class="form-item">
          <text class="label">è”ç³»ç”µè¯</text>
          <input type="number" placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯" value="{{studentForm.phone}}" bindinput="onStudentFormInput" data-field="phone" />
        </view>
        <view class="form-item">
          <text class="label">å®¶é•¿å§“å</text>
          <input type="text" placeholder="è¯·è¾“å…¥å®¶é•¿å§“å" value="{{studentForm.parentName}}" bindinput="onStudentFormInput" data-field="parentName" />
        </view>
        <view class="form-item">
          <text class="label">å¤‡æ³¨</text>
          <textarea placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯" value="{{studentForm.remark}}" bindinput="onStudentFormInput" data-field="remark" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn cancel" bindtap="hideStudentModal">å–æ¶ˆ</button>
        <button class="btn confirm" bindtap="saveStudent">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- å­¦å‘˜è¯¦æƒ…å¼¹çª— -->
  <view class="modal {{showDetailModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideDetailModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>å­¦å‘˜è¯¦æƒ…</text>
        <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="detail-item">
          <text class="label">å§“å</text>
          <text class="value">{{currentStudent.name}}</text>
        </view>
        <view class="detail-item">
          <text class="label">æ€§åˆ«</text>
          <text class="value">{{currentStudent.gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
        </view>
        <view class="detail-item">
          <text class="label">å¹´é¾„</text>
          <text class="value">{{currentStudent.age}}å²</text>
        </view>
        <view class="detail-item">
          <text class="label">è”ç³»ç”µè¯</text>
          <text class="value">{{currentStudent.phone}}</text>
        </view>
        <view class="detail-item">
          <text class="label">å®¶é•¿å§“å</text>
          <text class="value">{{currentStudent.parentName}}</text>
        </view>
        <view class="detail-item">
          <text class="label">æŠ¥åè¯¾ç¨‹</text>
          <text class="value">{{currentStudent.courses}}</text>
        </view>
        <view class="detail-item">
          <text class="label">å‡ºå‹¤ç‡</text>
          <text class="value">{{currentStudent.attendanceRate}}</text>
        </view>
        <view class="detail-item">
          <text class="label">å¤‡æ³¨</text>
          <text class="value">{{currentStudent.remark}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn confirm" bindtap="hideDetailModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
