<!--campus.wxml-->
<view class="page">
  <view class="header">
    <view class="title">校区管理</view>
  </view>

  <!-- 搜索和添加区域 -->
  <view class="search-add-container">
    <view class="search-box">
      <input type="text" placeholder="搜索校区" bindinput="onSearch" value="{{searchKey}}" />
      <view class="search-icon">🔍</view>
    </view>
    <button class="add-btn" bindtap="showAddCampus">添加</button>
  </view>

  <!-- 校区列表 -->
  <scroll-view class="campus-list" scroll-y enable-back-to-top>
    <view wx:if="{{loading && campusList.length === 0}}" class="loading-tip">加载中...</view>
    <view wx:elif="{{!loading && campusList.length === 0}}" class="empty-tip">暂无校区</view>
    <view wx:for="{{campusList}}" wx:key="id" class="campus-item">
      <view class="campus-info" bindtap="showCampusDetail" data-id="{{item.id}}">
        <view class="campus-name">{{item.name}}</view>
        <view class="campus-address">{{item.address}}</view>
        <view class="campus-meta">
          <text class="campus-phone">{{item.managerPhone || '暂无电话'}}</text>
          <text class="dot">·</text>
          <text class="campus-manager">负责人: {{item.managerName || '暂无'}}</text>
        </view>
        <view class="campus-stats">
          <text class="stat-item">学员: {{item.studentCount || 0}}人</text>
          <text class="stat-item">教练: {{item.coachCount || 0}}人</text>
          <text class="stat-item">月租: ¥{{item.monthlyRent || 0}}</text>
        </view>
      </view>
      <view class="campus-actions">
        <view class="action-btn edit" catchtap="editCampus" data-id="{{item.id}}">编辑</view>
        <view class="action-btn delete" catchtap="deleteCampus" data-id="{{item.id}}">删除</view>
      </view>
    </view>

    <!-- 加载更多提示 -->
    <view wx:if="{{loading && campusList.length > 0}}" class="load-more-tip">加载中...</view>
    <view wx:elif="{{!hasMore && campusList.length > 0}}" class="load-more-tip">没有更多了</view>
  </scroll-view>

  <!-- 添加/编辑校区弹窗 -->
  <view class="modal {{showCampusModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideCampusModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>{{editingCampus ? '编辑校区' : '添加校区'}}</text>
        <view class="modal-close" bindtap="hideCampusModal">×</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">校区名称</text>
          <input type="text" placeholder="请输入校区名称" value="{{campusForm.name}}" bindinput="onCampusFormInput" data-field="name" />
        </view>
        <view class="form-item">
          <text class="label">详细地址</text>
          <input type="text" placeholder="请输入详细地址" value="{{campusForm.address}}" bindinput="onCampusFormInput" data-field="address" />
        </view>
        <view class="form-item">
          <text class="label">运营状态</text>
          <picker bindchange="onStatusChange" value="{{campusForm.status === 'OPERATING' ? 0 : 1}}" range="{{['营业中', '已关闭']}}">
            <view class="picker">{{campusForm.status === 'OPERATING' ? '营业中' : '已关闭'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">月租金</text>
          <input type="digit" placeholder="请输入月租金" value="{{campusForm.monthlyRent}}" bindinput="onCampusFormInput" data-field="monthlyRent" />
        </view>
        <view class="form-item">
          <text class="label">物业费</text>
          <input type="digit" placeholder="请输入物业费" value="{{campusForm.propertyFee}}" bindinput="onCampusFormInput" data-field="propertyFee" />
        </view>
        <view class="form-item">
          <text class="label">水电费</text>
          <input type="digit" placeholder="请输入水电费" value="{{campusForm.utilityFee}}" bindinput="onCampusFormInput" data-field="utilityFee" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn cancel" bindtap="hideCampusModal">取消</button>
        <button class="btn confirm" bindtap="saveCampus">确定</button>
      </view>
    </view>
  </view>

  <!-- 校区详情弹窗 -->
  <view class="modal {{showDetailModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideDetailModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>校区详情</text>
        <view class="modal-close" bindtap="hideDetailModal">×</view>
      </view>
      <view class="modal-body">
        <view class="detail-item">
          <text class="label">校区名称</text>
          <text class="value">{{currentCampus.name}}</text>
        </view>
        <view class="detail-item">
          <text class="label">详细地址</text>
          <text class="value">{{currentCampus.address}}</text>
        </view>
        <view class="detail-item">
          <text class="label">月租金</text>
          <text class="value">¥{{currentCampus.monthlyRent || 0}}</text>
        </view>
        <view class="detail-item">
          <text class="label">物业费</text>
          <text class="value">¥{{currentCampus.propertyFee || 0}}</text>
        </view>
        <view class="detail-item">
          <text class="label">水电费</text>
          <text class="value">¥{{currentCampus.utilityFee || 0}}</text>
        </view>
        <view class="detail-item">
          <text class="label">负责人姓名</text>
          <text class="value">{{currentCampus.managerName || '暂无'}}</text>
        </view>
        <view class="detail-item">
          <text class="label">负责人电话</text>
          <text class="value">{{currentCampus.managerPhone || '暂无'}}</text>
        </view>
        <view class="detail-note">
          <text class="note-text">注：负责人信息需要通过其他方式设置</text>
        </view>
        <view class="detail-item">
          <text class="label">学员数量</text>
          <text class="value">{{currentCampus.studentCount || 0}}人</text>
        </view>
        <view class="detail-item">
          <text class="label">教练数量</text>
          <text class="value">{{currentCampus.coachCount || 0}}人</text>
        </view>
        <view class="detail-item">
          <text class="label">待上课程</text>
          <text class="value">{{currentCampus.pendingLessonCount || 0}}个</text>
        </view>
        <view class="detail-item">
          <text class="label">运营状态</text>
          <text class="value">{{currentCampus.status === 'OPERATING' ? '营业中' : '已关闭'}}</text>
        </view>
        <view class="detail-item">
          <text class="label">创建时间</text>
          <text class="value">{{currentCampus.createdTime || '暂无'}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn confirm" bindtap="hideDetailModal">关闭</button>
      </view>
    </view>
  </view>
</view>
