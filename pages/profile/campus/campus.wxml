<!--campus.wxml-->
<view class="page">
  <view class="header">
    <view class="title">æ ¡åŒºç®¡ç†</view>
  </view>

  <!-- æœç´¢å’Œæ·»åŠ åŒºåŸŸ -->
  <view class="search-add-container">
    <view class="search-box">
      <input type="text" placeholder="æœç´¢æ ¡åŒº" bindinput="onSearch" value="{{searchKey}}" />
      <view class="search-icon">ğŸ”</view>
    </view>
    <button class="add-btn" bindtap="showAddCampus">æ·»åŠ </button>
  </view>

  <!-- æ ¡åŒºåˆ—è¡¨ -->
  <scroll-view class="campus-list" scroll-y enable-back-to-top>
    <view wx:if="{{loading && campusList.length === 0}}" class="loading-tip">åŠ è½½ä¸­...</view>
    <view wx:elif="{{!loading && campusList.length === 0}}" class="empty-tip">æš‚æ— æ ¡åŒº</view>
    <view wx:for="{{campusList}}" wx:key="id" class="campus-item">
      <view class="campus-info" bindtap="showCampusDetail" data-id="{{item.id}}">
        <view class="campus-name">{{item.name}}</view>
        <view class="campus-address">{{item.address}}</view>
        <view class="campus-meta">
          <text class="campus-phone">{{item.managerPhone || 'æš‚æ— ç”µè¯'}}</text>
          <text class="dot">Â·</text>
          <text class="campus-manager">è´Ÿè´£äºº: {{item.managerName || 'æš‚æ— '}}</text>
        </view>
        <view class="campus-stats">
          <text class="stat-item">å­¦å‘˜: {{item.studentCount || 0}}äºº</text>
          <text class="stat-item">æ•™ç»ƒ: {{item.coachCount || 0}}äºº</text>
          <text class="stat-item">æœˆç§Ÿ: Â¥{{item.monthlyRent || 0}}</text>
        </view>
      </view>
      <view class="campus-actions">
        <view class="action-btn edit" catchtap="editCampus" data-id="{{item.id}}">ç¼–è¾‘</view>
        <view class="action-btn delete" catchtap="deleteCampus" data-id="{{item.id}}">åˆ é™¤</view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view wx:if="{{loading && campusList.length > 0}}" class="load-more-tip">åŠ è½½ä¸­...</view>
    <view wx:elif="{{!hasMore && campusList.length > 0}}" class="load-more-tip">æ²¡æœ‰æ›´å¤šäº†</view>
  </scroll-view>

  <!-- æ·»åŠ /ç¼–è¾‘æ ¡åŒºå¼¹çª— -->
  <view class="modal {{showCampusModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideCampusModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>{{editingCampus ? 'ç¼–è¾‘æ ¡åŒº' : 'æ·»åŠ æ ¡åŒº'}}</text>
        <view class="modal-close" bindtap="hideCampusModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="label">æ ¡åŒºåç§°</text>
          <input type="text" placeholder="è¯·è¾“å…¥æ ¡åŒºåç§°" value="{{campusForm.name}}" bindinput="onCampusFormInput" data-field="name" />
        </view>
        <view class="form-item">
          <text class="label">è¯¦ç»†åœ°å€</text>
          <input type="text" placeholder="è¯·è¾“å…¥è¯¦ç»†åœ°å€" value="{{campusForm.address}}" bindinput="onCampusFormInput" data-field="address" />
        </view>
        <view class="form-item">
          <text class="label">è¿è¥çŠ¶æ€</text>
          <picker bindchange="onStatusChange" value="{{campusForm.status === 'OPERATING' ? 0 : 1}}" range="{{['è¥ä¸šä¸­', 'å·²å…³é—­']}}">
            <view class="picker">{{campusForm.status === 'OPERATING' ? 'è¥ä¸šä¸­' : 'å·²å…³é—­'}}</view>
          </picker>
        </view>
        <view class="form-item">
          <text class="label">æœˆç§Ÿé‡‘</text>
          <input type="digit" placeholder="è¯·è¾“å…¥æœˆç§Ÿé‡‘" value="{{campusForm.monthlyRent}}" bindinput="onCampusFormInput" data-field="monthlyRent" />
        </view>
        <view class="form-item">
          <text class="label">ç‰©ä¸šè´¹</text>
          <input type="digit" placeholder="è¯·è¾“å…¥ç‰©ä¸šè´¹" value="{{campusForm.propertyFee}}" bindinput="onCampusFormInput" data-field="propertyFee" />
        </view>
        <view class="form-item">
          <text class="label">æ°´ç”µè´¹</text>
          <input type="digit" placeholder="è¯·è¾“å…¥æ°´ç”µè´¹" value="{{campusForm.utilityFee}}" bindinput="onCampusFormInput" data-field="utilityFee" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn cancel" bindtap="hideCampusModal">å–æ¶ˆ</button>
        <button class="btn confirm" bindtap="saveCampus">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ ¡åŒºè¯¦æƒ…å¼¹çª— -->
  <view class="modal {{showDetailModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideDetailModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>æ ¡åŒºè¯¦æƒ…</text>
        <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="detail-item">
          <text class="label">æ ¡åŒºåç§°</text>
          <text class="value">{{currentCampus.name}}</text>
        </view>
        <view class="detail-item">
          <text class="label">è¯¦ç»†åœ°å€</text>
          <text class="value">{{currentCampus.address}}</text>
        </view>
        <view class="detail-item">
          <text class="label">æœˆç§Ÿé‡‘</text>
          <text class="value">Â¥{{currentCampus.monthlyRent || 0}}</text>
        </view>
        <view class="detail-item">
          <text class="label">ç‰©ä¸šè´¹</text>
          <text class="value">Â¥{{currentCampus.propertyFee || 0}}</text>
        </view>
        <view class="detail-item">
          <text class="label">æ°´ç”µè´¹</text>
          <text class="value">Â¥{{currentCampus.utilityFee || 0}}</text>
        </view>
        <view class="detail-item">
          <text class="label">è´Ÿè´£äººå§“å</text>
          <text class="value">{{currentCampus.managerName || 'æš‚æ— '}}</text>
        </view>
        <view class="detail-item">
          <text class="label">è´Ÿè´£äººç”µè¯</text>
          <text class="value">{{currentCampus.managerPhone || 'æš‚æ— '}}</text>
        </view>
        <view class="detail-note">
          <text class="note-text">æ³¨ï¼šè´Ÿè´£äººä¿¡æ¯éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼è®¾ç½®</text>
        </view>
        <view class="detail-item">
          <text class="label">å­¦å‘˜æ•°é‡</text>
          <text class="value">{{currentCampus.studentCount || 0}}äºº</text>
        </view>
        <view class="detail-item">
          <text class="label">æ•™ç»ƒæ•°é‡</text>
          <text class="value">{{currentCampus.coachCount || 0}}äºº</text>
        </view>
        <view class="detail-item">
          <text class="label">å¾…ä¸Šè¯¾ç¨‹</text>
          <text class="value">{{currentCampus.pendingLessonCount || 0}}ä¸ª</text>
        </view>
        <view class="detail-item">
          <text class="label">è¿è¥çŠ¶æ€</text>
          <text class="value">{{currentCampus.status === 'OPERATING' ? 'è¥ä¸šä¸­' : 'å·²å…³é—­'}}</text>
        </view>
        <view class="detail-item">
          <text class="label">åˆ›å»ºæ—¶é—´</text>
          <text class="value">{{currentCampus.createdTime || 'æš‚æ— '}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn confirm" bindtap="hideDetailModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
