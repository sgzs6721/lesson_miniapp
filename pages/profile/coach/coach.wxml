<!--coach.wxml-->
<view class="page">
  <view class="header">
    <view class="title">æ•™ç»ƒç®¡ç†</view>
  </view>

  <!-- æœç´¢å’Œæ·»åŠ åŒºåŸŸ -->
  <view class="search-add-container">
    <view class="search-box">
      <input type="text" placeholder="æœç´¢æ•™ç»ƒ" bindinput="onSearch" value="{{searchKey}}" />
      <view class="search-icon">ğŸ”</view>
    </view>
    <button class="add-btn" bindtap="showAddCoach">æ·»åŠ </button>
  </view>

  <!-- æ ¡åŒºç­›é€‰ -->
  <view class="filter-container">
    <picker mode="selector" range="{{campusList}}" range-key="name" value="{{selectedCampusIndex}}" bindchange="onCampusFilterChange">
      <view class="filter-picker">
        <text>{{campusList[selectedCampusIndex].name || 'è¯·é€‰æ‹©æ ¡åŒº'}}</text>
        <text class="filter-arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- æ•™ç»ƒåˆ—è¡¨ -->
  <scroll-view class="coach-list" scroll-y>
    <view wx:if="{{!selectedCampusId}}" class="empty-tip">è¯·é€‰æ‹©æ ¡åŒºæŸ¥çœ‹æ•™ç»ƒ</view>
    <view wx:elif="{{loading && coachList.length === 0}}" class="loading-tip">åŠ è½½ä¸­...</view>
    <view wx:elif="{{coachList.length === 0}}" class="empty-tip">æš‚æ— æ•™ç»ƒ</view>
    <view wx:for="{{coachList}}" wx:key="id" class="coach-item">
      <view class="coach-info" bindtap="showCoachDetail" data-id="{{item.id}}">
        <image class="coach-avatar" src="{{item.avatar || '/images/default-avatar.png'}}"></image>
        <view class="coach-detail">
          <view class="coach-name">
            {{item.name}}
            <text class="coach-gender">{{item.gender === 'MALE' ? 'ç”·' : 'å¥³'}}</text>
            <text class="coach-age">{{item.age}}å²</text>
          </view>
          <view class="coach-meta">
            <text>{{item.phone}}</text>
            <text class="dot">Â·</text>
            <text>{{item.campusName}}</text>
          </view>
          <view class="coach-info-row">
            <text>{{item.jobTitle}}</text>
            <text class="dot">Â·</text>
            <text>{{item.experience}}å¹´æ•™é¾„</text>
            <text class="dot">Â·</text>
            <text class="status-{{item.status}}">{{item.status === 'ACTIVE' ? 'åœ¨èŒ' : (item.status === 'VACATION' ? 'ä¼‘å‡ä¸­' : 'å·²ç¦»èŒ')}}</text>
          </view>
        </view>
      </view>
      <view class="coach-actions">
        <view class="action-btn edit" catchtap="editCoach" data-id="{{item.id}}">ç¼–è¾‘</view>
        <view class="action-btn delete" catchtap="deleteCoach" data-id="{{item.id}}">åˆ é™¤</view>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤šæç¤º -->
    <view wx:if="{{loading && coachList.length > 0}}" class="loading-more">åŠ è½½ä¸­...</view>
    <view wx:elif="{{!hasMore && coachList.length > 0}}" class="no-more">æ²¡æœ‰æ›´å¤šäº†</view>
  </scroll-view>

  <!-- æ·»åŠ /ç¼–è¾‘æ•™ç»ƒå¼¹çª— -->
  <view class="modal {{showCoachModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideCoachModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>{{editingCoach ? 'ç¼–è¾‘æ•™ç»ƒ' : 'æ·»åŠ æ•™ç»ƒ'}}</text>
        <view class="modal-close" bindtap="hideCoachModal">Ã—</view>
      </view>
      <view class="modal-body">
        <!-- åŸºæœ¬ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
          <view class="form-item">
            <text class="label">å§“å</text>
            <input type="text" placeholder="è¯·è¾“å…¥å§“å" value="{{coachForm.name}}" bindinput="onCoachFormInput" data-field="name" />
          </view>
          <view class="form-item">
            <text class="label">æ€§åˆ«</text>
            <picker mode="selector" range="{{genderOptions}}" value="{{coachForm.genderIndex}}" bindchange="onGenderChange">
              <view class="picker">
                {{genderOptions[coachForm.genderIndex] || 'è¯·é€‰æ‹©æ€§åˆ«'}}
              </view>
            </picker>
          </view>
          <view class="form-item">
            <text class="label">å¹´é¾„</text>
            <input type="number" placeholder="è¯·è¾“å…¥å¹´é¾„" value="{{coachForm.age}}" bindinput="onCoachFormInput" data-field="age" />
          </view>
          <view class="form-item">
            <text class="label">è”ç³»ç”µè¯</text>
            <input type="text" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" value="{{coachForm.phone}}" bindinput="onCoachFormInput" data-field="phone" />
          </view>
        </view>

        <!-- èŒä½ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-title">èŒä½ä¿¡æ¯</view>
          <view class="form-item">
            <text class="label">èŒä½</text>
            <picker mode="selector" range="{{jobTitleOptions}}" value="{{coachForm.jobTitleIndex}}" bindchange="onJobTitleChange">
              <view class="picker">
                {{jobTitleOptions[coachForm.jobTitleIndex] || 'è¯·é€‰æ‹©èŒä½'}}
              </view>
            </picker>
          </view>
          <view class="form-item">
            <text class="label">æ•™é¾„(å¹´)</text>
            <input type="number" placeholder="è¯·è¾“å…¥æ•™é¾„" value="{{coachForm.experience}}" bindinput="onCoachFormInput" data-field="experience" />
          </view>
          <view class="form-item">
            <text class="label">å…¥èŒæ—¥æœŸ</text>
            <picker mode="date" value="{{coachForm.hireDate}}" bindchange="onHireDateChange">
              <view class="picker">
                {{coachForm.hireDate || 'è¯·é€‰æ‹©å…¥èŒæ—¥æœŸ'}}
              </view>
            </picker>
          </view>
          <view class="form-item">
            <text class="label">çŠ¶æ€</text>
            <picker mode="selector" range="{{statusOptions}}" value="{{coachForm.statusIndex}}" bindchange="onStatusChange">
              <view class="picker">
                {{statusOptions[coachForm.statusIndex] || 'è¯·é€‰æ‹©çŠ¶æ€'}}
              </view>
            </picker>
          </view>

          <view class="form-item">
            <text class="label">æ‰€å±æ ¡åŒº</text>
            <!-- ç¼–è¾‘æ¨¡å¼æ˜¾ç¤ºæ ¡åŒºåç§°ï¼ˆåªè¯»ï¼‰ï¼Œæ·»åŠ æ¨¡å¼æ˜¾ç¤ºé€‰æ‹©å™¨ -->
            <view wx:if="{{editingCoach}}" class="readonly-field">
              <text>{{coachForm.campusName || 'æœªçŸ¥æ ¡åŒº'}}</text>
            </view>
            <picker wx:else mode="selector" range="{{campusList}}" range-key="name" value="{{coachForm.campusIndex}}" bindchange="onCampusChange">
              <view class="picker">
                {{campusList[coachForm.campusIndex].name || 'è¯·é€‰æ‹©æ‰€å±æ ¡åŒº'}}
              </view>
            </picker>
          </view>
          <view class="form-item">
            <text class="label">æŒæœ‰è¯ä¹¦</text>
            <textarea placeholder="æ¯è¡Œè¾“å…¥ä¸€ä¸ªè¯ä¹¦" value="{{coachForm.certifications}}" bindinput="onCoachFormInput" data-field="certifications" />
          </view>
        </view>

        <!-- è–ªèµ„ä¿¡æ¯ -->
        <view class="form-section">
          <view class="section-title">è–ªèµ„ä¿¡æ¯</view>
          <view class="form-item">
            <text class="label">åŸºæœ¬å·¥èµ„</text>
            <input type="digit" placeholder="è¯·è¾“å…¥åŸºæœ¬å·¥èµ„(å…ƒ)" value="{{coachForm.baseSalary}}" bindinput="onCoachFormInput" data-field="baseSalary" />
          </view>
          <view class="form-item">
            <text class="label">ç¤¾ä¿è´¹</text>
            <input type="digit" placeholder="è¯·è¾“å…¥ç¤¾ä¿è´¹(å…ƒ)" value="{{coachForm.socialInsurance}}" bindinput="onCoachFormInput" data-field="socialInsurance" />
          </view>
          <view class="form-item">
            <text class="label">è¯¾æ—¶è´¹(å…ƒ/æ—¶)</text>
            <input type="digit" placeholder="è¯·è¾“å…¥è¯¾æ—¶è´¹" value="{{coachForm.classFee}}" bindinput="onCoachFormInput" data-field="classFee" />
          </view>
          <view class="form-item">
            <text class="label">ç»©æ•ˆå¥–é‡‘</text>
            <input type="digit" placeholder="è¯·è¾“å…¥ç»©æ•ˆå¥–é‡‘(å…ƒ)" value="{{coachForm.performanceBonus}}" bindinput="onCoachFormInput" data-field="performanceBonus" />
          </view>
          <view class="form-item">
            <text class="label">ææˆ(%)</text>
            <input type="digit" placeholder="è¯·è¾“å…¥ææˆæ¯”ä¾‹" value="{{coachForm.commission}}" bindinput="onCoachFormInput" data-field="commission" />
          </view>
          <view class="form-item">
            <text class="label">åˆ†çº¢</text>
            <input type="digit" placeholder="è¯·è¾“å…¥åˆ†çº¢(å…ƒ)" value="{{coachForm.dividend}}" bindinput="onCoachFormInput" data-field="dividend" />
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn cancel" bindtap="hideCoachModal">å–æ¶ˆ</button>
        <button class="btn confirm" bindtap="saveCoach">ç¡®å®š</button>
      </view>
    </view>
  </view>

  <!-- æ•™ç»ƒè¯¦æƒ…å¼¹çª— -->
  <view class="modal {{showDetailModal ? 'show' : ''}}">
    <view class="modal-mask" bindtap="hideDetailModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>æ•™ç»ƒè¯¦æƒ…</text>
        <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="detail-section">
          <view class="section-title">åŸºæœ¬ä¿¡æ¯</view>
          <view class="detail-item">
            <text class="label">å§“åï¼š</text>
            <text class="value">{{currentCoach.name}}</text>
          </view>
          <view class="detail-item">
            <text class="label">æ€§åˆ«ï¼š</text>
            <text class="value">{{currentCoach.gender === 'MALE' ? 'ç”·' : 'å¥³'}}</text>
          </view>
          <view class="detail-item">
            <text class="label">å¹´é¾„ï¼š</text>
            <text class="value">{{currentCoach.age}}å²</text>
          </view>
          <view class="detail-item">
            <text class="label">è”ç³»ç”µè¯ï¼š</text>
            <text class="value">{{currentCoach.phone}}</text>
          </view>
        </view>

        <view class="detail-section">
          <view class="section-title">èŒä½ä¿¡æ¯</view>
          <view class="detail-item">
            <text class="label">èŒä½ï¼š</text>
            <text class="value">{{currentCoach.jobTitle}}</text>
          </view>
          <view class="detail-item">
            <text class="label">å…¥èŒæ—¥æœŸï¼š</text>
            <text class="value">{{currentCoach.hireDate}}</text>
          </view>
          <view class="detail-item">
            <text class="label">æ•™é¾„ï¼š</text>
            <text class="value">{{currentCoach.experience}}å¹´</text>
          </view>
          <view class="detail-item">
            <text class="label">çŠ¶æ€ï¼š</text>
            <text class="value">{{currentCoach.status === 'ACTIVE' ? 'åœ¨èŒ' : (currentCoach.status === 'VACATION' ? 'ä¼‘å‡ä¸­' : 'å·²ç¦»èŒ')}}</text>
          </view>
          <view class="detail-item">
            <text class="label">æ‰€å±æ ¡åŒºï¼š</text>
            <text class="value">{{currentCoach.campusName}}</text>
          </view>
          <view class="detail-item">
            <text class="label">æŒæœ‰è¯ä¹¦ï¼š</text>
            <text class="value">{{currentCoach.certificationsText || 'æ— '}}</text>
          </view>
        </view>

        <view class="detail-section" wx:if="{{currentCoach.salary}}">
          <view class="section-title">è–ªèµ„ä¿¡æ¯</view>
          <view class="detail-item">
            <text class="label">åŸºæœ¬å·¥èµ„ï¼š</text>
            <text class="value">{{currentCoach.salary.baseSalary}}å…ƒ</text>
          </view>
          <view class="detail-item">
            <text class="label">ç¤¾ä¿è´¹ï¼š</text>
            <text class="value">{{currentCoach.salary.socialInsurance}}å…ƒ</text>
          </view>
          <view class="detail-item">
            <text class="label">è¯¾æ—¶è´¹ï¼š</text>
            <text class="value">{{currentCoach.salary.classFee}}å…ƒ/æ—¶</text>
          </view>
          <view class="detail-item">
            <text class="label">ç»©æ•ˆå¥–é‡‘ï¼š</text>
            <text class="value">{{currentCoach.salary.performanceBonus}}å…ƒ</text>
          </view>
          <view class="detail-item">
            <text class="label">ææˆï¼š</text>
            <text class="value">{{currentCoach.salary.commission}}%</text>
          </view>
          <view class="detail-item">
            <text class="label">åˆ†çº¢ï¼š</text>
            <text class="value">{{currentCoach.salary.dividend}}å…ƒ</text>
          </view>
          <view class="detail-item" wx:if="{{currentCoach.salary.effectiveDate}}">
            <text class="label">ç”Ÿæ•ˆæ—¥æœŸï¼š</text>
            <text class="value">{{currentCoach.salary.effectiveDate}}</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn confirm" bindtap="hideDetailModal">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
